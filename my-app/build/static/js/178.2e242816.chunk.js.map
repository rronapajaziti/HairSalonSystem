{"version":3,"file":"static/js/178.2e242816.chunk.js","mappings":"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","sources":["pages/ServiceStaff.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { MdOutlineDelete } from 'react-icons/md';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\nconst ServiceStaff = () => {\r\n  const [serviceStaffList, setServiceStaffList] = useState<any[]>([]);\r\n  const [dailyEarnings, setDailyEarnings] = useState<any[]>([]);\r\n  const [discounts, setDiscounts] = useState<any[]>([]);\r\n  const [filterDate, setFilterDate] = useState<string>(\r\n    new Date().toISOString().split('T')[0],\r\n  );\r\n\r\n  useEffect(() => {\r\n    fetchServiceStaff();\r\n    fetchDailyEarnings();\r\n    fetchDiscounts();\r\n\r\n    const handleDataUpdate = () => {\r\n      fetchServiceStaff();\r\n      fetchDailyEarnings();\r\n      fetchDiscounts();\r\n    };\r\n\r\n    window.addEventListener('dataUpdated', handleDataUpdate);\r\n\r\n    return () => {\r\n      window.removeEventListener('dataUpdated', handleDataUpdate);\r\n    };\r\n  }, [filterDate]);\r\n\r\n  const fetchServiceStaff = async () => {\r\n    try {\r\n      const token = localStorage.getItem('adminToken');\r\n      if (!token) throw new Error('No token found');\r\n\r\n      const decodedToken: any = jwtDecode(token);\r\n\r\n      const roleID = decodedToken.RolesID || decodedToken.roleID; // Adjust claim name as needed\r\n      const userID = localStorage.getItem('userId'); // Ensure consistency\r\n\r\n      if (!userID) {\r\n        console.error('UserID not found in localStorage!');\r\n        return;\r\n      }\r\n\r\n      const response = await axios.get(\r\n        'https://api.studio-linda.com/api/ServiceStaff',\r\n        {\r\n          params: { roleID, userID }, // Pass roleID and userID to the backend\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        },\r\n      );\r\n\r\n      // Update the state with all data\r\n      setServiceStaffList(response.data);\r\n    } catch (error) {\r\n      console.error('Error fetching service staff data:', error);\r\n    }\r\n  };\r\n\r\n  const fetchDailyEarnings = async () => {\r\n    try {\r\n      const token = localStorage.getItem('adminToken');\r\n      if (!token) throw new Error('No token found');\r\n\r\n      const decodedToken: any = jwtDecode(token);\r\n\r\n      const roleID = decodedToken.RolesID || decodedToken.roleID; // Adjust claim name as needed\r\n      const userID = localStorage.getItem('userId'); // Ensure consistency\r\n\r\n      const response = await axios.get(\r\n        'https://api.studio-linda.com/api/ServiceStaff/daily-earnings',\r\n        {\r\n          params: { roleID, userID }, // Pass roleID and userID to the backend\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        },\r\n      );\r\n\r\n      if (roleID == 3 || roleID == '3') {\r\n        setDailyEarnings(\r\n          response.data.filter((item: any) => String(item.userID) === userID),\r\n        );\r\n      } else {\r\n        setDailyEarnings(response.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching daily earnings:', error);\r\n    }\r\n  };\r\n\r\n  const fetchDiscounts = async () => {\r\n    try {\r\n      const response = await axios.get(\r\n        'https://api.studio-linda.com/api/ServiceDiscount',\r\n      );\r\n      setDiscounts(response.data);\r\n    } catch (error) {\r\n      console.error('Error fetching discounts:', error);\r\n    }\r\n  };\r\n\r\n  const calculateDiscountedPrice = (\r\n    servicePrice: number,\r\n    serviceID: number,\r\n  ) => {\r\n    const now = new Date();\r\n    const applicableDiscount = discounts.find(\r\n      (discount) =>\r\n        discount.serviceID === serviceID &&\r\n        new Date(discount.startDate) <= now &&\r\n        new Date(discount.endDate) >= now,\r\n    );\r\n\r\n    if (applicableDiscount) {\r\n      return (\r\n        servicePrice -\r\n        (servicePrice * applicableDiscount.discountPercentage) / 100\r\n      ).toFixed(2);\r\n    }\r\n\r\n    return servicePrice.toFixed(2);\r\n  };\r\n\r\n  const filteredServiceStaff = serviceStaffList.filter((item) => {\r\n    if (!item.dateCompleted) return false; // Skip invalid dates\r\n    const itemDate = new Date(item.dateCompleted).toISOString().split('T')[0];\r\n    return itemDate === filterDate;\r\n  });\r\n\r\n  const filteredDailyEarnings = dailyEarnings.filter((item) => {\r\n    const itemDate = new Date(Date.UTC(item.year, item.month - 1, item.day))\r\n      .toISOString()\r\n      .split('T')[0];\r\n    return itemDate === filterDate;\r\n  });\r\n\r\n  const handleDelete = async (id: number) => {\r\n    try {\r\n      await axios.delete(`https://api.studio-linda.com/api/ServiceStaff/${id}`);\r\n      await fetchServiceStaff(); // Refresh the data\r\n    } catch (error) {\r\n      console.error('Error deleting ServiceStaff record:', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"rounded-sm border border-stroke text-black bg-white px-5 pt-6 pb-2.5 shadow-default sm:px-7.5 xl:pb-1 dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n      <div className=\"flex items-center mb-4\">\r\n        <label className=\"mr-4 text-black dark:text-white\">\r\n          Filtro sipas datës:\r\n        </label>\r\n        <input\r\n          type=\"date\"\r\n          value={filterDate}\r\n          onChange={(e) => setFilterDate(e.target.value)}\r\n          className=\"px-4 py-2 border rounded-md text-black dark:text-white dark:border-strokedark dark:bg-boxdark\"\r\n        />\r\n      </div>{' '}\r\n      <h1 className=\"text-xl font-semibold text-blue-900 dark:text-white \">\r\n        Pagesa sipas Shërbimit\r\n      </h1>\r\n      {/* Service Staff Table */}\r\n      <div className=\"overflow-x-auto mt-6\">\r\n        <table className=\"w-full text-left border-collapse text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n          <thead>\r\n            <tr className=\"bg-gray-200\">\r\n              <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                Emri i Punëtores\r\n              </th>\r\n              <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                Shërbimi\r\n              </th>\r\n              <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                Çmimi i Shërbimit\r\n              </th>\r\n              <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                Përqindja\r\n              </th>\r\n              <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                Pagesa për shërbim\r\n              </th>\r\n              <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                Data e përfundimit\r\n              </th>\r\n              <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                Veprime\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {filteredServiceStaff.map((item) => {\r\n              const discountedPrice = parseFloat(\r\n                calculateDiscountedPrice(item.servicePrice, item.serviceID),\r\n              );\r\n              const staffEarning = (discountedPrice * item.percentage) / 100;\r\n\r\n              return (\r\n                <tr key={item.serviceStaffID}>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {item.staffName || 'N/A'}\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {item.serviceName || 'N/A'}\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {discountedPrice.toFixed(2)}€\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {item.percentage?.toFixed(2) || '0.00'}%\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {staffEarning.toFixed(2)}€\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {item.dateCompleted\r\n                      ? new Date(item.dateCompleted).toLocaleString()\r\n                      : 'N/A'}\r\n                  </td>\r\n                  <td>\r\n                    <button\r\n                      onClick={() => handleDelete(item.serviceStaffID)}\r\n                      className=\"bg-red-500 text-white rounded-md px-4 py-2 text-base sm:px-4 sm:py-2 sm:text-sm\"\r\n                    >\r\n                      <MdOutlineDelete />\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      {/* Daily Earnings Table */}\r\n      <div className=\"mt-10\">\r\n        <h2 className=\"text-xl font-semibold text-blue-900 dark:text-white \">\r\n          Pagesat Ditore\r\n        </h2>\r\n        <div className=\"overflow-x-auto mt-6\">\r\n          <table className=\"w-full text-left border-collapse text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n            <thead>\r\n              <tr className=\"bg-gray-200\">\r\n                <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                  Emri i Punëtores\r\n                </th>\r\n                <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                  Dita\r\n                </th>\r\n                <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                  Muaji\r\n                </th>\r\n                <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                  Viti\r\n                </th>\r\n                <th className=\"py-2 px-4 text-black dark:text-white dark:border-strokedark dark:bg-boxdark\">\r\n                  Totali\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {filteredDailyEarnings.map((item) => (\r\n                <tr\r\n                  key={`${item.staffID}-${item.year}-${item.month}-${item.day}`}\r\n                >\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {item.staffName}\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {item.day}\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {new Date(item.year, item.month - 1).toLocaleString('sq', {\r\n                      month: 'long',\r\n                    })}\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {item.year}\r\n                  </td>\r\n                  <td className=\"py-2 px-4 text-black dark:text-white\">\r\n                    {item.totalEarnings.toFixed(2)}€\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ServiceStaff;\r\n"],"names":["ServiceStaff","serviceStaffList","setServiceStaffList","useState","dailyEarnings","setDailyEarnings","discounts","setDiscounts","filterDate","setFilterDate","Date","toISOString","split","useEffect","fetchServiceStaff","fetchDailyEarnings","fetchDiscounts","handleDataUpdate","window","addEventListener","removeEventListener","async","token","localStorage","getItem","Error","decodedToken","jwtDecode","roleID","RolesID","userID","console","error","response","axios","get","params","headers","Authorization","data","filter","item","String","filteredServiceStaff","dateCompleted","filteredDailyEarnings","UTC","year","month","day","_jsxs","className","children","_jsx","type","value","onChange","e","target","map","_item$percentage","discountedPrice","parseFloat","calculateDiscountedPrice","servicePrice","serviceID","now","applicableDiscount","find","discount","startDate","endDate","discountPercentage","toFixed","staffEarning","percentage","staffName","serviceName","toLocaleString","onClick","delete","id","handleDelete","serviceStaffID","MdOutlineDelete","totalEarnings","staffID"],"sourceRoot":""}